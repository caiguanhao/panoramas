var scenes = {
  "wenta-park-01": {
    "sides": [
      "images/wenta-park-01.front.jpg",
      "images/wenta-park-01.right.jpg",
      "images/wenta-park-01.back.jpg",
      "images/wenta-park-01.left.jpg",
      "images/wenta-park-01.top.jpg",
      "images/wenta-park-01.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76033,
      113.26714
    ]
  },
  "wenta-park-02": {
    "sides": [
      "images/wenta-park-02.front.jpg",
      "images/wenta-park-02.right.jpg",
      "images/wenta-park-02.back.jpg",
      "images/wenta-park-02.left.jpg",
      "images/wenta-park-02.top.jpg",
      "images/wenta-park-02.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76049,
      113.26757
    ]
  },
  "wenta-park-03": {
    "sides": [
      "images/wenta-park-03.front.jpg",
      "images/wenta-park-03.right.jpg",
      "images/wenta-park-03.back.jpg",
      "images/wenta-park-03.left.jpg",
      "images/wenta-park-03.top.jpg",
      "images/wenta-park-03.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76062,
      113.26712
    ]
  },
  "wenta-park-04": {
    "sides": [
      "images/wenta-park-04.front.jpg",
      "images/wenta-park-04.right.jpg",
      "images/wenta-park-04.back.jpg",
      "images/wenta-park-04.left.jpg",
      "images/wenta-park-04.top.jpg",
      "images/wenta-park-04.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76087,
      113.26716
    ]
  },
  "wenta-park-05": {
    "sides": [
      "images/wenta-park-05.front.jpg",
      "images/wenta-park-05.right.jpg",
      "images/wenta-park-05.back.jpg",
      "images/wenta-park-05.left.jpg",
      "images/wenta-park-05.top.jpg",
      "images/wenta-park-05.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76105,
      113.26699
    ]
  },
  "wenta-park-06": {
    "sides": [
      "images/wenta-park-06.front.jpg",
      "images/wenta-park-06.right.jpg",
      "images/wenta-park-06.back.jpg",
      "images/wenta-park-06.left.jpg",
      "images/wenta-park-06.top.jpg",
      "images/wenta-park-06.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76119,
      113.26736
    ]
  },
  "wenta-park-07": {
    "sides": [
      "images/wenta-park-07.front.jpg",
      "images/wenta-park-07.right.jpg",
      "images/wenta-park-07.back.jpg",
      "images/wenta-park-07.left.jpg",
      "images/wenta-park-07.top.jpg",
      "images/wenta-park-07.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76098,
      113.26740
    ]
  },
  "wenta-park-08": {
    "sides": [
      "images/wenta-park-08.front.jpg",
      "images/wenta-park-08.right.jpg",
      "images/wenta-park-08.back.jpg",
      "images/wenta-park-08.left.jpg",
      "images/wenta-park-08.top.jpg",
      "images/wenta-park-08.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76153,
      113.26722
    ]
  },
  "wenta-park-09": {
    "sides": [
      "images/wenta-park-09.front.jpg",
      "images/wenta-park-09.right.jpg",
      "images/wenta-park-09.back.jpg",
      "images/wenta-park-09.left.jpg",
      "images/wenta-park-09.top.jpg",
      "images/wenta-park-09.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76203,
      113.26698
    ]
  },
  "wenta-park-10": {
    "sides": [
      "images/wenta-park-10.front.jpg",
      "images/wenta-park-10.right.jpg",
      "images/wenta-park-10.back.jpg",
      "images/wenta-park-10.left.jpg",
      "images/wenta-park-10.top.jpg",
      "images/wenta-park-10.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76199,
      113.26708
    ]
  },
  "wenta-park-11": {
    "sides": [
      "images/wenta-park-11.front.jpg",
      "images/wenta-park-11.right.jpg",
      "images/wenta-park-11.back.jpg",
      "images/wenta-park-11.left.jpg",
      "images/wenta-park-11.top.jpg",
      "images/wenta-park-11.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76125,
      113.26632
    ]
  },
  "wenta-park-12": {
    "sides": [
      "images/wenta-park-12.front.jpg",
      "images/wenta-park-12.right.jpg",
      "images/wenta-park-12.back.jpg",
      "images/wenta-park-12.left.jpg",
      "images/wenta-park-12.top.jpg",
      "images/wenta-park-12.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76132,
      113.26591
    ]
  },
  "wenta-park-13": {
    "sides": [
      "images/wenta-park-13.front.jpg",
      "images/wenta-park-13.right.jpg",
      "images/wenta-park-13.back.jpg",
      "images/wenta-park-13.left.jpg",
      "images/wenta-park-13.top.jpg",
      "images/wenta-park-13.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76174,
      113.26628
    ]
  },
  "wenta-park-14": {
    "sides": [
      "images/wenta-park-14.front.jpg",
      "images/wenta-park-14.right.jpg",
      "images/wenta-park-14.back.jpg",
      "images/wenta-park-14.left.jpg",
      "images/wenta-park-14.top.jpg",
      "images/wenta-park-14.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76246,
      113.26706
    ]
  },
  "wenta-park-15": {
    "sides": [
      "images/wenta-park-15.front.jpg",
      "images/wenta-park-15.right.jpg",
      "images/wenta-park-15.back.jpg",
      "images/wenta-park-15.left.jpg",
      "images/wenta-park-15.top.jpg",
      "images/wenta-park-15.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76239,
      113.26731
    ]
  },
  "wenta-park-16": {
    "sides": [
      "images/wenta-park-16.front.jpg",
      "images/wenta-park-16.right.jpg",
      "images/wenta-park-16.back.jpg",
      "images/wenta-park-16.left.jpg",
      "images/wenta-park-16.top.jpg",
      "images/wenta-park-16.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76233,
      113.26751
    ]
  },
  "wenta-park-17": {
    "sides": [
      "images/wenta-park-17.front.jpg",
      "images/wenta-park-17.right.jpg",
      "images/wenta-park-17.back.jpg",
      "images/wenta-park-17.left.jpg",
      "images/wenta-park-17.top.jpg",
      "images/wenta-park-17.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76218,
      113.26781
    ]
  },
  "wenta-park-18": {
    "sides": [
      "images/wenta-park-18.front.jpg",
      "images/wenta-park-18.right.jpg",
      "images/wenta-park-18.back.jpg",
      "images/wenta-park-18.left.jpg",
      "images/wenta-park-18.top.jpg",
      "images/wenta-park-18.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76200,
      113.26731
    ]
  },
  "wenta-park-19": {
    "sides": [
      "images/wenta-park-19.front.jpg",
      "images/wenta-park-19.right.jpg",
      "images/wenta-park-19.back.jpg",
      "images/wenta-park-19.left.jpg",
      "images/wenta-park-19.top.jpg",
      "images/wenta-park-19.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76254,
      113.26813
    ]
  },
  "wenta-park-20": {
    "sides": [
      "images/wenta-park-20.front.jpg",
      "images/wenta-park-20.right.jpg",
      "images/wenta-park-20.back.jpg",
      "images/wenta-park-20.left.jpg",
      "images/wenta-park-20.top.jpg",
      "images/wenta-park-20.bottom.jpg"
    ],
    "lon": 90,
    "autorotate": 0,
    "touch": true,
    "gyro": false,
    "coordinates": [
      22.76252,
      113.26855
    ]
  }
};
parse_panorama(scenes);

var markers = [];

for (var first_scene in scenes) break;

$(window).on("hashchange", function() {
  var scene = window.location.hash.substr(1);
  if (!scenes.hasOwnProperty(scene)) {
    scene = first_scene;
  }
  for (var i = 0; i < markers.length; i++) {
    var marker = markers[i];
    if (marker.sceneName === scene) {
      marker.setIcon('../css/img/green-dot.png');
    } else {
      marker.setIcon('../css/img/red-dot.png');
    }
  }
});

google.maps.event.addDomListener(window, 'load', function() {
  var map = new google.maps.Map(document.getElementById('map-canvas'), {
    zoom: 17,
    center: new google.maps.LatLng(22.76168, 113.26734),
    mapTypeId: google.maps.MapTypeId.SATELLITE
  });

  var scene = window.location.hash.substr(1);
  var default_scene = first_scene;
  if (scenes.hasOwnProperty(scene)) {
    default_scene = scene;
  }

  for (var sceneName in scenes) {
    var scene = scenes[sceneName];
    var coordinates = scene.coordinates;
    if (!coordinates) continue;
    var marker = new google.maps.Marker({
      position: new google.maps.LatLng(coordinates[0], coordinates[1]),
      map: map,
      icon: default_scene === sceneName ? '../css/img/green-dot.png' : '../css/img/red-dot.png',
      title: coordinates[0] + ', ' + coordinates[1]
    });
    marker.sceneName = sceneName;
    google.maps.event.addListener(marker, 'click', (function(name) {
      return function() {
        window.location.hash = name;
      };
    })(sceneName));
    markers.push(marker);
  }

  // debug:
  // var marker = new google.maps.Marker({
  //   position: map.getCenter(),
  //   map: map,
  //   draggable: true
  // });
  // google.maps.event.addListener(marker, 'dragend', function() {
  //   var p = marker.getPosition();
  //   console.log(p.d.toFixed(5) + ',\n      ' + p.e.toFixed(5));
  // });
});
